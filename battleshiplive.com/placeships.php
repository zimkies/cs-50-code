<?php    	/****************************************************************	 placeships.php provides the player with an interface to place their 	 ships. It listens for any clicks on any part of the board, and	 calls place.php to update the database whenever a click is made.	 ***************************************************************/		// require common code    require_once("includes/common.php"); 		// select my information    $sql = sprintf("SELECT * FROM users WHERE uid='%s'",$_SESSION["uid"]);    $return = mysql_query($sql);	$myinfo = mysql_fetch_array($return);?><!DOCTYPE html      PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">  <head>    <link href="css/styles1.css" rel="stylesheet" type="text/css" />    <title>Battleship</title>			<script type="text/javascript">	//<![CDATA[        // global variables    var xmlhttp1 = null;	var xmlhttp2 = null;    var response = null;  	var orient = 'right';	var boat = '0';	var length = 1;				// page is refreshed every few seconds	function load()	{		loadXMLDoc('reload.php', loader);		setInterval("loadXMLDoc('reload.php', turn_loader)", 2000);	}		// page checks whether or not it is your turn, if it is then redirects to play.php	function turn_loader()	{        if (xmlhttp1.readyState==4)        {			// when ready, call function            if (xmlhttp1.status==200)			{ 				// get xml				var request = xmlhttp1.responseXML;				var users_tag = request.getElementsByTagName("users");				var users = users_tag[0];				var status = users.getAttribute("status");							// redirect to play.php if you and opponent have placed all pieces				if (status == 'play')					window.location = 'play.php';			}		}	}		// redraws the table every time the page is refreshed.	function loader()	{        if (xmlhttp1.readyState==4)        {			// when ready, call function            if (xmlhttp1.status==200)			{ 				// get xml				var request = xmlhttp1.responseXML;				var users_tag = request.getElementsByTagName("users");				var users = users_tag[0];				var dot_tags = request.getElementsByTagName("boardxml");								// give variables names				boat = users.getAttribute("boat");				orient = users.getAttribute("orient");				length = users.getAttribute("length");				boat = users.getAttribute("boat");				var turn = users.getAttribute("turn");				var status = users.getAttribute("status");				var placed = new Array();								for (i = 1; i <= 5; i++)				{					placer = 'placed' + i;					placed[i - 1] = users.getAttribute(placer);				}															// redirect to play.php if you and opponent have placed all pieces				if (status == 'play')					window.location = 'play.php';									// if a ship is selected, then show that it is selected				if (boat != '0')				{					var b_selected = 's' + boat;					document.getElementById(b_selected).src = boat_to_image(boat, 'select');				}												// Change each ship selector to its yellow if it is selected, or green if placed				for (var j = 1; j <= 5; j++)				{					if (placed[j - 1] == '1')					{						var temp = 's' + j;						switch (temp)											{												case 's1':								document.getElementById(temp).src = "images/patrolboat.png";								document.getElementById(temp).name = "images/patrolboat.png";								break;							case 's2':								document.getElementById(temp).src = "images/submarine.png";								document.getElementById(temp).name = "images/submarine.png";								break;							case 's3':								document.getElementById(temp).src = "images/destroyer.png";								document.getElementById(temp).name = "images/destroyer.png";								break;							case 's4':								document.getElementById(temp).src = "images/battleship.png";								document.getElementById(temp).name = "images/battleship.png";																break;							case 's5':								document.getElementById(temp).src = "images/aircraftcarrier.png";								document.getElementById(temp).name = "images/aircraftcarrier.png";								break;											}					}														}								// for each coordinate on your board, place a marker if a ship is placed there				for (i = 0; i < dot_tags.length; i++)				{					// get current position					var dot_tag = dot_tags[i];					var dot = dot_tag.getAttribute("position");					var ship = dot_tag.getAttribute("ship");										// change the image at position to color of boat					if (ship)						var image = 'images/' + 'boat' + ship + '.png';					else						var image = 'images/clear.png';					document.getElementById(dot).src = image;					document.getElementById(dot).name = image;				}										}			        }          }		        // function connects to url    function loadXMLDoc(url, myfunc)    {        // code for all new browsers        if (window.XMLHttpRequest)        {            xmlhttp1=new XMLHttpRequest();        }        // code for IE5 and IE6        else if (window.ActiveXObject)        {            xmlhttp1=new ActiveXObject("Microsoft.XMLHTTP");        }                // on ready calls state_Change        if (xmlhttp1!=null)        {            xmlhttp1.onreadystatechange=myfunc;            xmlhttp1.open("GET", url, true);            xmlhttp1.send(null);        }        // alerts if browser is not supported        else        {            alert("Your browser does not support XMLHTTP.");        }    }		// if you click on the rotate button, highlight it, and update database	function r_click(i)	{		document.getElementById("r").src = "images/rotateclick.png";		click(i);	}		// gets an element by id tag 'i' and type of button 't' and highlights it.	function mouseOver(i)	{		if (i[0] == 'r')			document.getElementById(i).src ="images/rotate.png";				else if (i[0] == 'b')		{ 			var id = '';			var temp = '';			var alphabet = 'abcdefghij';			for (var j = 0; j < Number(length); j++)			{								switch (orient)				{						case 'down':											var temp = Number(i[1]) + j;						id = 'b' + temp + i[2];						break;					case 'left':						var temp = alphabet[todigit(i[2]) - j];						id = 'b' + i[1] + temp;						break;					case 'up':						var temp = Number(i[1]) - j;						id = 'b' + temp + i[2];						break;					case 'right':						var temp = alphabet[todigit(i[2]) + j];						id = 'b' + i[1] + temp;						break;					default:						printf("something is not right");						return false;							break;				}					document.getElementById(id).src ="images/select.png";			}		}	}		// replaces a button's image with the image stored in its name tag	function mouseOut(i)	{		var id = '';		var temp = '';		var alphabet = 'abcdefghij';		for (var j = 0; j < Number(length); j++)		{							switch (orient)			{					case 'down':										var temp = Number(i[1]) + j;					id = 'b' + temp + i[2];					break;				case 'left':					var temp = alphabet[todigit(i[2]) - j];					id = 'b' + i[1] + temp;					break;				case 'up':					var temp = Number(i[1]) - j;					id = 'b' + temp + i[2];					break;				case 'right':					var temp = alphabet[todigit(i[2]) + j];					id = 'b' + i[1] + temp;					break;				default:					printf("something is not right");					return false;						break;			}				document.getElementById(id).src = document.getElementById(id).name;		}		document.getElementById(i).src = document.getElementById(i).name;	}		// calls place.php and when it has run, call place()	function click(i)	{		url = 'place.php' +  '?point=' + i;		loadXMLDoc(url, place);				}		// changes the rotate button to normal	function up(i)	{		document.getElementById("r").src = "images/rotate.png";	}		// grabs xml from place.php if someone has clicked on a button in placeships.php	function place()	{        if (xmlhttp1.readyState==4)        {			// when ready, call function            if (xmlhttp1.status==200)            {    				// get xml				var request = xmlhttp1.responseXML;				var info_tag = request.getElementsByTagName("info");				var info = info_tag[0];				var position_tags = request.getElementsByTagName("shippart");								// gives names to variables				boat = info.getAttribute("boat");				length = info.getAttribute("length");				orient = info.getAttribute("orient");						var line = info.getAttribute("line");				var success = info.getAttribute("success");								var place_tag = position_tags[0];				var place = place_tag.getAttribute("position");				var image;								// If a ship was selected, change the ship's image.				if (success == 'selected')				{							line = "You have selected a ship. Place it on the ocean";					var boats = 's' + boat;					switch (place)										{																	case 's1':														document.getElementById(boats).src = document.getElementById(boats).name;							document.getElementById(place).src = boat_to_image('1', 'select');														break;						case 's2':							document.getElementById(boats).src = document.getElementById(boats).name;													document.getElementById(place).src = boat_to_image('2', 'select');							break;						case 's3':							document.getElementById(boats).src = document.getElementById(boats).name;									document.getElementById(place).src = boat_to_image('3', 'select');							break;						case 's4':							document.getElementById(boats).src = document.getElementById(boats).name;									document.getElementById(place).src = boat_to_image('4', 'select');							break;						case 's5':							document.getElementById(boats).src = document.getElementById(boats).name;									document.getElementById(place).src = boat_to_image('5', 'select');							break;						}				}								if (success == 'no_select')				{					line = "You have already placed this ship!";				}								// if you rotated the ship, change the tag showing your orientation				if (success == 'rotated')				{					line = "You have rotated your selected ship";							switch (orient)					{							case 'up':						document.getElementById("orientation").innerHTML="Boat Orientation: up";						break;						case 'down':						document.getElementById("orientation").innerHTML="Boat Orientation: down";						break;						case 'left':						document.getElementById("orientation").innerHTML="Boat Orientation: left";						break;						case 'right':						document.getElementById("orientation").innerHTML="Boat Orientation: right";						break;						default:						break;					}				}								// if a ship has been placed, place it on the board				if (success == 'placed')				{					switch (boat)					{						case '1':							image = "images/boat1.png";							break;						case '2':							image = "images/boat2.png";							break;						case '3':							image = "images/boat3.png";							break;						case '4':							image = "images/boat4.png";							break;						case '5':							image = "images/boat5.png";							break;						default :							image = "images/clear.png";					}										for (i = 0; i < position_tags.length; i++)					{						// get current position						var position_tag = position_tags[i];						position = position_tag.getAttribute("position");												// change the image at position to color of boat						document.getElementById(position).src = image;						document.getElementById(position).name = image;					}										var tag = 's' + boat;										// turns a boat green if it has been placed					switch (tag)										{											case 's1':							document.getElementById(tag).src = "images/patrolboat.png";							document.getElementById(tag).name = "images/patrolboat.png";							break;						case 's2':							document.getElementById(tag).src = "images/submarine.png";							document.getElementById(tag).name = "images/submarine.png";							break;						case 's3':							document.getElementById(tag).src = "images/destroyer.png";							document.getElementById(tag).name = "images/destroyer.png";							break;						case 's4':							document.getElementById(tag).src = "images/battleship.png";							document.getElementById(tag).name = "images/battleship.png";														break;						case 's5':							document.getElementById(tag).src = "images/aircraftcarrier.png";							document.getElementById(tag).name = "images/aircraftcarrier.png";							break;										}										// return length to 1					length = 1;										if (!line)						line = "Well Placed Commander! If you have not placed all ships, select a new one";				}				inform(line);			}        }          }		// function boat_to_image takes a boat number and its stage, outputting its png name;	function boat_to_image(boatint, stage)	{		var myboat;					switch (boatint)		{			case '1':				myboat = 'patrolboat';				break;			case '2':				myboat = 'submarine';				break;			case '3':				myboat = 'destroyer';				break;			case '4':				myboat = 'battleship';				break;			case '5':				myboat = "aircraftcarrier";				break;			default:				break;		}				if (stage != 'me')			myboat += stage;			png = "images/" + myboat + ".png";		return png;	}			// function todigit() converts a single letter  from a to j into an integer from 0 to 9.	// WARNING! does not check for argument errors.		function todigit(chr)	{		var alphabet = 'abcdefghij';		for (var i = 0; i < 10; i++)		{			if (alphabet[i] == chr)				var intr = Number(i);		}		return intr;	}		// informs the player of the txt	function inform(txt)	{		document.getElementById("informer").innerHTML=txt;	}				//]]>	</script>  </head>  <body onload="load()">	<div size="100px" id="informer"> Please choose a ship to start! </div>	<table class="big">		<tr>			<td>				<table class="top">					<?php for ($counterx = 0; $counterx <5; $counterx += 1) { 						if ($counterx == 0)						{							$boat = "patrolboatstart.png";							$boatid = "s1";						}						if ($counterx == 1)						{							$boat = "submarinestart.png";							$boatid = "s2";						}						if ($counterx == 2)						{							$boat = "destroyerstart.png";							$boatid = "s3";						}						if ($counterx == 3)						{							$boat = "battleshipstart.png";							$boatid = "s4";						}						if ($counterx == 4)						{							$boat = "aircraftcarrierstart.png"; 							$boatid = "s5";						}					?>												<tr>							<td> 								<img src="images/<?echo "$boat";?>" id="<?echo "$boatid";?>"  name="images/<?echo "$boat";?>" 									onmousedown="click('<?echo "$boatid";?>')"																	/> 														</td>						</tr>					<? } ?>				</table>			</td>						<td>				<table class="message">						<tr>							<td id="orientation">							Boat Orientation: right							<td>						</tr>								<table class="rotate">														<tr>								<td>							<img src="images/rotate.png" name="images/rotate.png" id = "r" 								onmousedown="r_click('r')" onmouseup="mouseOut('r')" onmouseout="mouseOut('r')"/>								</td>						</tr>																						</table>			</td>						<td>						Your Board							<table class="grid">				<?php for ($counterx = 0; $counterx <= 9; $counterx += 1) { ?>								<tr>					<?php for ($countery = 0; $countery <= 9; $countery += 1) { ?>					<td>						<img							src="images/clear.png" 							id="b<?echo "$counterx"."$alphabet[$countery]";?>" 							onmouseover="mouseOver('b<?echo "$counterx"."$alphabet[$countery]";?>')" 							onmouseout="mouseOut('b<?echo "$counterx"."$alphabet[$countery]";?>')" 							onmousedown="click('b<?echo "$counterx"."$alphabet[$countery]";?>')" 							name="images/clear.png"							/>					<? } ?>					</td>				</tr>				<? } ?>				</table>																				</td>								</tr>			</table>			</div>  </body></html>