<?php    	/****************************************************************	 play.php provides the player with an interface to place their 	 ships. It listens for any clicks on any part of the board, and	 calls place.php to update the database whenever a click is made.	 ***************************************************************/		// require common code    require_once("includes/common.php"); ?><!DOCTYPE html      PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">	 <html xmlns="http://www.w3.org/1999/xhtml">  <head>    <link href="css/styles1.css" rel="stylesheet" type="text/css" />    <title>Battleship</title>		<script type="text/javascript">		//<![CDATA[        // global variables    var xmlhttp1 = null;	var xmlhttp2 = null;    var response = null;	var turn;		var my_board = new Array();    var ai_board = new Array();		// function load() updates html every 3 seconds.	function load()	{		for (var i = 0; i < 10; i++)		{			my_board[i] = [];			ai_board[i] = [];		}				loadXMLDoc('reload_play.php', loader);		setInterval("loadXMLDoc('reload_play.php', loader)", 3000);		setInterval("loadXMLDoc('ai_play.php', ai_shoot)", 2000);	}		// gets xml from reload_play.php and uses it to update pictures    function loader()	{        if (xmlhttp1.readyState==4)        {			// when ready, call function            if (xmlhttp1.status==200)			{ 				// gets xml				var request = xmlhttp1.responseXML;				var users_tag = request.getElementsByTagName("users");				var users = users_tag[0];				var dot_tags = request.getElementsByTagName("boardxml");								var selected = users.getAttribute("boat");				turn = users.getAttribute("turn");				var status = users.getAttribute("status");				var placed = new Array();				var b_placed = new Array();								// redirect to winning or losing image if game is over				if (status == 'win')				{						window.location = 'logout.php';					window.location = 'images/win.jpg';								}				if (status == 'lost')					window.location = 'images/lose.jpg';								// this will display the state of the turn				if (turn == 1)				{					document.getElementById("turn").innerHTML="Your Turn";				}				if (turn == 0)				{					document.getElementById("turn").innerHTML="Opponent is moving";				}								// create more variable names for ships that have been placed				for (i = 1; i <= 5; i++)				{					placer = 'placed' + i;					placed[i - 1] = users.getAttribute(placer);					b_placer = 'bad_placed' + i;					b_placed[i-1] = users.getAttribute(b_placer);				}											// Change each ship selector to it's color				for (i = 1; i <= 5; i++)				{					if (placed[i - 1] == '2')					{						boats = 's' + i;						document.getElementById(boats).src =  boat_to_image(i, 'dead');					}					// change opponents ships to relevant color					if (b_placed[i - 1] == '2')					{						boats = num_to_ship(i);						document.getElementById(boats).src =  boat_to_image(i, 'dead');					}				}					// places all dots on the board				for (i = 0; i < dot_tags.length; i++)				{					// get current position					var dot_tag = dot_tags[i];					var dot = dot_tag.getAttribute("position");					var ship = dot_tag.getAttribute("ship");					my_board[Number(dot[1])][dot[2]] = ship;				alert(my_board[Number(dot[1])][dot[2]]);					// change the image at position to color of boat					switch (ship)					{						case '1':						case '2':						case '3':						case '4':						case '5':							var image = 'images/' + 'boat' + ship + '.png';							break;						case '6':							var image = 'images/' + 'miss.png';							break;						case '7':							var image = 'images/' + 'hit.png';							break;						default:							var image = 'images/clear.png';							break;										}					document.getElementById(dot).src = image;					document.getElementById(dot).name = image;				}									// do the same for the enemy's board				for (i = 0; i < dot_tags.length; i++)				{					// get current position					var dot_tag = dot_tags[i];					var dot = dot_tag.getAttribute("bad_position");					var ship = dot_tag.getAttribute("bad_ship");					ai_board[Number(dot[1])][dot[2]] = ship;										// change the image at position to color of boat					switch (ship)					{						case '6':							var image = 'images/' + 'miss.png';							break;						case '7':							var image = 'images/' + 'hit.png';							break;						default:							var image = 'images/clear.png';							break;										}					document.getElementById(dot).src = image;					document.getElementById(dot).name = image;				}				}			        }          }					// Connects to url    function loadXMLDoc(url, myfunc)    {        // code for all new browsers        if (window.XMLHttpRequest)        {            xmlhttp1=new XMLHttpRequest();        }        // code for IE5 and IE6        else if (window.ActiveXObject)        {            xmlhttp1=new ActiveXObject("Microsoft.XMLHTTP");        }                // on ready calls state_Change        if (xmlhttp1!=null)        {            xmlhttp1.onreadystatechange=myfunc;            xmlhttp1.open("GET", url, true);            xmlhttp1.send(null);        }        // alerts if browser is not supported        else        {            alert("Your browser does not support XMLHTTP.");        }    }		// when mouse is over an image, selects	function mouseOver(i)	{		document.getElementById(i).src ="images/select.png";	}		// when mouse is no longer over an image, returns it to its default colour	function mouseOut(i)	{		document.getElementById(i).src = document.getElementById(i).name;	}		// runs shoot.php and then calls shoot.php	function click(i)	{		board = i[0];		row = i[1];		column = i[2];		url = 'shoot.php' +  '?board=' + board + '&row=' + row + '&column=' + column;		if (turn == 1)		{			turn = 0;			document.getElementById("turn").innerHTML="Opponent is moving";			loadXMLDoc(url, shoot);		}		}		// plays a sound whenever something has been hit or missed	function playsound(sound) 	{	var thissound = document.getElementById(sound);	thissound.Play();	}	// uses xml from shoot.php after someone shoots. updates various displays	function shoot()	{        if (xmlhttp1.readyState==4)        {            // when ready, call function            if (xmlhttp1.status==200)            {    				var request = xmlhttp1.responseXML;				var myxml = request.getElementsByTagName("info");				var myxml2 = myxml[0];								var board = myxml2.getAttribute("board");				var column = myxml2.getAttribute("column");				var row = myxml2.getAttribute("row");				var position = board + row + column;							var status = myxml2.getAttribute("status");				var msg = myxml2.getAttribute("line");				var sunk = myxml2.getAttribute("sunk");				turn = myxml2.getAttribute("turn");												// changes the board depending on whether the shot missed or hit				switch (status)				{					case '':						document.getElementById(position).src = "images/miss.png";						document.getElementById(position).name = "images/miss.png";						msg = "You missed! " + msg;						inform(msg);						playsound('miss');						break;					case '1':					case '2':					case '3':					case '4':					case '5':						document.getElementById(position).src = "images/hit.png";						document.getElementById(position).name = "images/hit.png";						if (!msg)							msg = "You hit a ship! ";						inform(msg);						playsound('hit');						break;					case '6':						document.getElementById(position).src = "images/miss.png";						document.getElementById(position).name = "images/miss.png";						msg = "You already missed there! " + msg;						inform(msg);						break;					case '7':						document.getElementById(position).src = "images/hit.png";						document.getElementById(position).name = "images/hit.png";						msg = "You already hit that ship! " + msg;						inform(msg);						break;						case 'won':						inform(msg);						break;					case 'no_turn':						inform(msg);						break;					default:						break;				}				// if a ship has been sunk, turn its larger image red				if (sunk)				{					switch (sunk)					{						case '1':							document.getElementById("patrolboat").src = "images/patrolboatdead.png";							break;						case '2':							document.getElementById("submarine").src = "images/submarinedead.png";							break;						case '3':							document.getElementById("destroyer").src = "images/destroyerdead.png";							break;						case '4':							document.getElementById("battleship").src = "images/battleshipdead.png";							break;						case '5':							document.getElementById("aircraftcarrier").src =								"images/aircraftcarrierdead.png";							break;						default:							break;					}				}			}        }          }		// ai_shoot for now does nothing	function ai_shoot()	{		 if (xmlhttp1.readyState==4)        {            // when ready, call function            if (xmlhttp1.status==200)				return;			}	}		// function takes a number and returns the ship it represents		function num_to_ship(num)	{		switch (num)		{			case '1': 			case 1:				var ship = "patrolboat";				break;			case '2': 			case 2:				var ship = "submarine";				break;			case '3':			case 3:				var ship = "destroyer";				break;			case '4': 			case 4:				var ship = "battleship";				break;			case '5':			case 5:				var ship = "aircraftcarrier";				break;			default:				return false;				break;		}		return ship;	}// function boat_to_image takes a boat number and its stage, outputting its png name;	function boat_to_image(boatint, stage)	{		switch (boatint)		{			case '1':			case 1:				var boat = 'patrolboat';				break;			case '2':			case 2:				var boat = 'submarine';				break;			case '3':			case 3:				var boat = 'destroyer';				break;			case '4':			case 4:				var boat = 'battleship';				break;			case '5':			case 5:				var boat = "aircraftcarrier";				break;			default:				break;		}		png = "images/" + boat + stage + ".png";		return png;	}		// informs users of text	function inform(txt)	{		document.getElementById("informer").innerHTML=txt;	}				//]]>	</script>		<embed src="audio/miss.wav" autostart=false width=0 height=0 id="miss"	enablejavascript="true">	<embed src="audio/hit.wav" autostart=false width=0 height=0 id="hit"	enablejavascript="true">  </head>  <body onload="load()">  	<table class="big">		<tr>					 					 <td id="turn">Turns will appear here!</td>					 <td id="informer">Alerts will appear here!  Good luck!</td>				</tr>		<tr>			<td>			<table class="top">										<tr>						<td> OPPONENT'S FLEET: </td>					</tr>					<?php for ($counterx = 0; $counterx <5; $counterx += 1) { 						if ($counterx == 0)							$boat = "patrolboat";						if ($counterx == 1)												$boat = "submarine";						if ($counterx == 2)							$boat = "destroyer";						if ($counterx == 3)							$boat = "battleship";						if ($counterx == 4)							$boat = "aircraftcarrier"; 					?>												<tr>							<td> <img src="images/<?echo "$boat" . ".png" ;?>" id="<?echo "$boat";?>" /> </td>						</tr>					<? } ?>														</table>			</td>							<td>						<div id="opponentboard">Opponent's Board</div>								<table class="grid">				<?php for ($counter = 0; $counter <= 9; $counter += 1) { ?>								<tr>					<?php for ($counterb = 0; $counterb <= 9; $counterb += 1) { ?>					<td> 						<img 							src="images/clear.png" 							id="a<?echo "$counter"."$alphabet[$counterb]";?>" 							onmouseover="mouseOver('a<?echo "$counter"."$alphabet[$counterb]";?>')" 							onmouseout="mouseOut('a<?echo "$counter"."$alphabet[$counterb]";?>')" 							onmousedown="click('a<?echo "$counter"."$alphabet[$counterb]";?>')" 							name="images/clear.png"							/>					</td> 					<? } ?>				</tr>				<? } ?>				</table>									<div id="yourboard">Your Board</div>							<table class="grid">				<?php for ($counterx = 0; $counterx <= 9; $counterx += 1) { ?>								<tr>					<?php for ($countery = 0; $countery <= 9; $countery += 1) { ?>					<td>						<img							src="images/clear.png" 							id="b<?echo "$counterx"."$alphabet[$countery]";?>" 							onmouseover="mouseOver('b<?echo "$counterx"."$alphabet[$countery]";?>')" 							onmouseout="mouseOut('b<?echo "$counterx"."$alphabet[$countery]";?>')" 							name="images/clear.png"							/>					<? } ?>					</td>				</tr>				<? } ?>				</table>							</td>						<td>							<table class="top">										<tr>							<td> YOUR FLEET: </td>					</tr>					<?php for ($counterx = 1; $counterx <= 5; $counterx += 1) { 						if ($counterx == 1)						$boat = "patrolboat.png";						if ($counterx == 2)						$boat = "submarine.png";						if ($counterx == 3)						$boat = "destroyer.png";						if ($counterx == 4)						$boat = "battleship.png";						if ($counterx == 5)						$boat = "aircraftcarrier.png"; 					?>												<tr>							<td> <img src="images/<?echo "$boat";?>" name="images/<?echo "$boat";?>" id="s<?echo "$counterx";?>" /> </td>						</tr>					<? } ?>														</table>			</td>		</tr>			</table>						<div>		<FONT COLOR="white">	<FONT SIZE="small">	<FONT ALIGN="center">		<p style="font-family:courier" s>						   <p>						   Created 2009 by Ben Kies and Michael Ingram - CS50 Final Project						   </p>                                                    </div>	</FONT></FONT></FONT>		</body></html>